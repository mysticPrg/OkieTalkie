/*
  * Copyright (c) 2013 Samsung Electronics Co., Ltd
  *
  * Licensed under the Flora License, Version 1.1 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *     http://floralicense.org/license/
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */

!function(a){var b=tau;!function(a,b){function c(b,c){return this.element=b,this.options=a.extendObject(c,this._options,!1),this.container=this.options.container,this.indices={original:this.options.index,merged:[]},this._init(),this}function d(b,c){return this.element=b,this.options=a.extendObject(c,this._options,!1),this.value=null,this._init(),this}function e(b,c){if(a===this)return new e(b);if(!this._isValidElement(b))throw"Invalid element is given";return this.element=b,this.indicator=null,this.indexBar1=null,this.indexBar2=null,this.index=null,this.touchAreaOffsetLeft=0,this.indexElements=null,this.selectEventTriggerTimeoutId=null,this.ulMarginTop=0,this.eventHandlers={},this._setOptions(c),this._isExtended()||this._create(),this._init(),this}a.IndexScrollbar||(c.prototype={_options:{container:null,offsetLeft:0,index:[],verticalCenter:!1,moreChar:"*",indexHeight:36,selectedClass:"ui-state-selected",ulClass:null},_init:function(){this.indices.original=this.options.index,this.maxIndexLen=0,this.indexLookupTable=[],this.indexElements=null,this.selectedIndex=-1,this._setMaxIndexLen(),this._makeMergedIndices(),this._drawDOM(),this._appendToContainer(),this.options.verticalCenter&&this._adjustVerticalCenter(),this._setIndexCellInfo()},_clear:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.indices.merged.length=0,this.indexLookupTable.length=0,this.indexElements=null,this.selectedIndex=-1},refresh:function(){this._clear(),this._init()},destroy:function(){this._clear(),this.element=null},show:function(){this.element.style.visibility="visible"},hide:function(){this.element.style.visibility="hidden"},_setMaxIndexLen:function(){var a,b=this.container.offsetHeight;a=Math.floor(b/this.options.indexHeight),a>0&&a%2===0&&(a-=1),this.maxIndexLen=a},_makeMergedIndices:function(){var a,b,c=this.indices.original,d=c.length,e=Math.min(this.maxIndexLen,d),f=d-e,g=parseInt(f/parseInt(e/2,10),10),h=f%parseInt(e/2,10),i=[],j=[],k=0;for(a=0,b=e;b>a;a++)i[a]=1,a%2&&(i[a]+=g+(h-->0?1:0)),k+=i[a],j.push({start:k-1,length:i[a]});this.indices.merged=j},_drawDOM:function(){var a,b,c,d,e,f=this.indices.original,g=this.indices.merged,h=g.length,i=this.options.indexHeight,i=this.options.indexHeight,j=this.options.moreChar,k=9;for(b=document.createDocumentFragment(),d=0;h>d;d++)e=g[d],a=1===e.length?f[e.start]:j,c=document.createElement("li"),c.innerText=a.toUpperCase(),c.style.height=i+"px",c.style.lineHeight=a===j?i+k+"px":i+"px",b.appendChild(c);this.element.appendChild(b),this.options.ulClass&&this.element.classList.add(this.options.ulClass)},_adjustVerticalCenter:function(){var a=this.indices.merged.length,b=a*this.options.indexHeight,c=parseInt((this.container.offsetHeight-b)/2,10);this.element.style.paddingTop=c+"px"},_appendToContainer:function(){this.container.appendChild(this.element),this.element.style.left=this.options.offsetLeft+"px"},setPaddingTop:function(a){var b=this.element.clientHeight,c=this.element.style.paddingTop,d=this.element.style.paddingBottom,e=this.container.clientHeight;c=""===c?0:parseInt(c,10),d=""===d?0:parseInt(d,10),b=b-c-d,a+b>e&&(a-=a+b-e),this.element.style.paddingTop=a+"px",this._setIndexCellInfo()},getOffsetTopByIndex:function(a){var b=this.indexLookupTable[a].cellIndex,c=this.indexElements[b],d=c.offsetTop;return d},_setIndexCellInfo:function(){var b=this.element,c=this.indices.merged,d=a.dom.getOffset(this.container).top,e=this.element.querySelectorAll("LI"),f=[];[].forEach.call(e,function(a,b){for(var e=c[b],g=e.start,h=g+e.length,i=d+a.offsetTop,j=a.offsetHeight/e.length;h>g;g++)f.push({cellIndex:b,top:i,range:j}),i+=j}),this.indexLookupTable=f,this.indexElements=b.children},getIndexByPosition:function(a){var b,c,d,e,f=this.indexLookupTable;if(f[0]&&(b=f[0],a<b.top))return 0;if(f[f.length-1]&&(b=f[f.length-1],a>=b.top+b.range))return f.length-1;for(c=0,d=f.length;d>c;c++)if(b=f[c],e=a-b.top,e>=0&&e<b.range)return c;return 0},getValueByIndex:function(a){return 0>a&&(a=0),this.indices.original[a]},select:function(a){var b,c;this.clearSelected(),this.selectedIndex!==a&&(this.selectedIndex=a,b=this.indexLookupTable[a].cellIndex,c=this.indexElements[b],c.classList.add(this.options.selectedClass))},clearSelected:function(){var a=this.element,b=this.options.selectedClass,c=a.querySelectorAll("."+b);[].forEach.call(c,function(a){a.classList.remove(b)}),this.selectedIndex=-1}},d.prototype={_options:{className:"ui-indexscrollbar-indicator",selectedClass:"ui-selected",container:null},_init:function(){var a=this.element;a.className=this.options.className,a.innerHTML="<span></span>",this.options.container.appendChild(a),this.fitToContainer()},fitToContainer:function(){var a=this.element,c=this.options.container,d=b.getComputedStyle(c).position;a.style.width=c.offsetWidth+"px",a.style.height=c.offsetHeight+"px","absolute"!==d&&"relative"!==d&&(a.style.top=c.offsetTop+"px",a.style.left=c.offsetLeft+"px")},setValue:function(a){this.value=a,a=a.toUpperCase();var b=a.substr(a.length-1),c=a.substr(0,a.length-1),d="<span>"+c+'</span><span class="ui-selected">'+b+"</span>";this.element.firstChild.innerHTML=d},show:function(){this.element.style.display="block"},hide:function(){this.element.style.display="none"},destroy:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element=null}},e.prototype={widgetName:"IndexScrollbar",widgetClass:"ui-indexscrollbar",_options:{moreChar:"*",selectedClass:"ui-state-selected",delimeter:",",index:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","1"],maxIndexLen:0,indexHeight:36,keepSelectEventDelay:50,container:null,supplementaryIndex:null,supplementaryIndexMargin:1},_create:function(){this._setInitialLayout(),this._createSubObjects(),this._updateLayout(),this._bindEvent(),this._extended(!0)},_init:function(){},refresh:function(){this._isExtended()&&(this._unbindEvent(),this.indicator.hide(),this._extended(!1)),this._updateLayout(),this._extended(!0)},destroy:function(){this._unbindEvent(),this._extended(!1),this._destroySubObjects(),this.element=null,this.indicator=null,this.index=null,this.eventHandlers=null},_setOptions:function(b){this.options=a.extendObject(b,this._options,!1),this.options.index=this._getIndex()},_createSubObjects:function(){this.indexBar1=new c(document.createElement("UL"),{container:this.element,offsetLeft:0,index:this.options.index,verticalCenter:!0,indexHeight:this.options.indexHeight}),this.options.supplementaryIndex&&(this.indexBar2=new c(document.createElement("UL"),{container:this.element,offsetLeft:-this.element.clientWidth-this.options.supplementaryIndexMargin,index:[],indexHeight:this.options.indexHeight,ulClass:"ui-indexscrollbar-supplementary"}),this.indexBar2.hide()),this.indicator=new d(document.createElement("DIV"),{container:this._getContainer()})},_destroySubObjects:function(){var a,b,c,d={iBar1:this.indexBar1,iBar2:this.indexBar2,indicator:this.indicator};for(c in d)a=d[c],a&&(b=a.element,a.destroy(),b.parentNode.removeChild(b))},_setInitialLayout:function(){var a=this.element,c=this._getContainer(),d=b.getComputedStyle(c).position;"absolute"!==d&&"relative"!==d&&(a.style.top=c.offsetTop+"px",a.style.height=c.style.height)},_setMaxIndexLen:function(){var a=this.options.maxIndexLen,b=this._getContainer(),c=b.offsetHeight;0>=a&&(a=Math.floor(c/this.options.indexHeight)),a>0&&a%2===0&&(a-=1),this.options.maxIndexLen=a},_updateLayout:function(){this._setInitialLayout(),this._draw(),this.touchAreaOffsetLeft=this.element.offsetLeft-10},_draw:function(){return this.indexBar1.show(),this},_removeIndicator:function(){var a=this.indicator,b=a.element.parentNode;b.removeChild(a.element),a.destroy(),this.indicator=null},_getEventReceiverByPosition:function(a){var c,d=b.innerWidth,e=this.element.clientWidth;return c=this.options.supplementaryIndex?a>=d-e&&d>=a?this.indexBar1:this.indexBar2:this.indexBar1},_updateIndicatorAndTriggerEvent:function(a){this.indicator.setValue(a),this.indicator.show(),this.selectEventTriggerTimeoutId&&b.clearTimeout(this.selectEventTriggerTimeoutId),this.selectEventTriggerTimeoutId=b.setTimeout(function(){this._trigger(this.element,"select",{index:a}),this.selectEventTriggerTimeoutId=null}.bind(this),this.options.keepSelectEventDelay)},_onTouchStartHandler:function(a){if(a.touches.length>1)return a.preventDefault(),a.stopPropagation(),void 0;var b=this._getPositionFromEvent(a),c=this.indexBar1,d=c.getIndexByPosition(b.y),e=c.getValueByIndex(d);c.select(d),this._updateIndicatorAndTriggerEvent(e)},_onTouchMoveHandler:function(a){if(a.touches.length>1)return a.preventDefault(),a.stopPropagation(),void 0;var b,c,d,e=this._getPositionFromEvent(a),f=this.indexBar1,g=this.indexBar2;c=this._getEventReceiverByPosition(e.x),c===g&&(g.options.index=this.options.supplementaryIndex(f.getValueByIndex(f.selectedIndex)),g.refresh()),b=c.getIndexByPosition(e.y),d=c.getValueByIndex(b),c===g&&(d=f.getValueByIndex(f.selectedIndex)+d,g.setPaddingTop(f.getOffsetTopByIndex(f.selectedIndex))),c.select(b),c.show(),f===c&&g&&g.hide(),this._updateIndicatorAndTriggerEvent(d),a.preventDefault(),a.stopPropagation()},_onTouchEndHandler:function(a){a.touches.length>0||(this.indicator.hide(),this.indexBar1.clearSelected(),this.indexBar2&&(this.indexBar2.clearSelected(),this.indexBar2.hide()))},_bindEvent:function(){this._bindResizeEvent(),this._bindEventToTriggerSelectEvent()},_unbindEvent:function(){this._unbindResizeEvent(),this._unbindEventToTriggerSelectEvent()},_bindResizeEvent:function(){this.eventHandlers.onresize=function(){this.refresh()}.bind(this),b.addEventListener("resize",this.eventHandlers.onresize)},_unbindResizeEvent:function(){this.eventHandlers.onresize&&b.removeEventListener("resize",this.eventHandlers.onresize)},_bindEventToTriggerSelectEvent:function(){this.eventHandlers.touchStart=this._onTouchStartHandler.bind(this),this.eventHandlers.touchEnd=this._onTouchEndHandler.bind(this),this.eventHandlers.touchMove=this._onTouchMoveHandler.bind(this),this.element.addEventListener("touchstart",this.eventHandlers.touchStart),this.element.addEventListener("touchmove",this.eventHandlers.touchMove),this.element.addEventListener("touchend",this.eventHandlers.touchEnd),document.addEventListener("touchcancel",this.eventHandlers.touchEnd)},_unbindEventToTriggerSelectEvent:function(){this.element.removeEventListener("touchstart",this.eventHandlers.touchStart),this.element.removeEventListener("touchmove",this.eventHandlers.touchMove),this.element.removeEventListener("touchend",this.eventHandlers.touchEnd),document.removeEventListener("touchcancel",this.eventHandlers.touchEnd)},_trigger:function(a,b,c){var d;if(!a||!a.nodeType||1!==a.nodeType)throw"Given element is not a valid DOM element";if("string"!=typeof b||b.length<=0)throw"Given eventName is not a valid string";return d=new CustomEvent(b,{detail:c,bubbles:!0,cancelable:!0}),a.dispatchEvent(d),!0},_data:function(a,b){var c,d=this.element,e=d.__data;if(e||(e=d.__data={}),"object"==typeof a){for(c in a)this._data(c,a[c]);return this}return"undefined"==typeof b?e[a]:(e[a]=b,this)},_isValidElement:function(a){return a.classList.contains(this.widgetClass)},_isExtended:function(){return!!this._data("extended")},_extended:function(a){return this._data("extended",a),this},_getIndex:function(){var a=this.element,b=this.options,c=a.getAttribute("data-index");return c=c?c.split(b.delimeter):b.indices},_getOffset:function(a){var b=0,c=0;do c+=a.offsetTop,b+=a.offsetLeft;while(a=a.offsetParent);return{top:c,left:b}},_getContainer:function(){return this.options.container||this.element.parentNode},_getPositionFromEvent:function(a){return-1!==a.type.search(/^touch/)?{x:a.touches[0].clientX,y:a.touches[0].clientY}:{x:a.clientX,y:a.clientY}},addEventListener:function(a,b){this.element.addEventListener(a,b)},removeEventListener:function(a,b){this.element.removeEventListener(a,b)}},a.IndexScrollbar=e)}(b,a)}(this);